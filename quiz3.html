<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CS 205 — Quiz 3: Stacks &amp; Queues</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
  background:#0f172a;color:#e2e8f0;min-height:100vh;padding:0;
}
button{font-family:inherit}
.app{max-width:720px;margin:0 auto;padding:20px 20px 80px}

/* Top bar */
.top-bar{
  position:sticky;top:0;z-index:100;
  background:#0f172aee;backdrop-filter:blur(8px);
  padding:12px 0 8px;margin-bottom:24px;display:none;
}
.top-bar.visible{display:block}
.progress-wrap{background:#1e293b;border-radius:8px;height:8px;overflow:hidden;margin-bottom:8px}
.progress-fill{height:100%;background:linear-gradient(90deg,#3b82f6,#8b5cf6);border-radius:8px;transition:width .4s ease;width:0}
.top-meta{display:flex;justify-content:space-between;font-size:.82em;color:#94a3b8}
.top-meta .timer{color:#60a5fa}

/* Screens */
.screen{display:none;animation:fadeIn .3s ease}
.screen.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* Welcome */
h1{font-size:1.9em;margin-bottom:6px}
.sub{color:#94a3b8;margin-bottom:28px;line-height:1.6}
.info-box{
  background:#1e293b;border:1px solid #334155;border-radius:12px;
  padding:20px;margin-bottom:20px;line-height:1.7;
}
.info-box h3{color:#60a5fa;margin-bottom:8px}

/* Form elements */
label.field{display:block;margin-bottom:18px}
label.field .label-text{display:block;font-weight:600;margin-bottom:6px;color:#f1f5f9}
input[type=text],select{
  width:100%;padding:12px 14px;border-radius:8px;border:1px solid #334155;
  background:#1e293b;color:#e2e8f0;font-size:1em;transition:border-color .2s;
}
input[type=text]:focus,select:focus{outline:none;border-color:#3b82f6}

/* Buttons */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:12px 28px;border-radius:8px;border:none;
  font-size:1em;font-weight:600;cursor:pointer;transition:all .2s;
}
.btn-primary{background:#3b82f6;color:#fff}
.btn-primary:hover{background:#2563eb;transform:translateY(-1px)}
.btn-primary:disabled{background:#334155;color:#64748b;cursor:not-allowed;transform:none}
.btn-secondary{background:#1e293b;color:#94a3b8;border:1px solid #334155}
.btn-secondary:hover{border-color:#3b82f6;color:#e2e8f0}
.btn-row{display:flex;gap:12px;margin-top:24px;flex-wrap:wrap}

/* Section header */
.section-header{margin-bottom:24px}
.section-header h2{font-size:1.5em;margin-bottom:4px}
.section-header p{color:#94a3b8;line-height:1.6}
.section-tag{
  display:inline-block;padding:3px 10px;border-radius:12px;
  font-size:.75em;font-weight:600;margin-bottom:10px;
}
.tag-purple{background:#3b1f6e;color:#a78bfa}
.tag-green{background:#064e3b;color:#34d399}

/* MCQ card */
.mcq-card{
  background:#1e293b;border:1px solid #334155;border-radius:12px;
  padding:24px;margin-bottom:16px;
}
.mcq-card .q-num{color:#64748b;font-size:.85em;margin-bottom:8px}
.mcq-card .q-text{font-size:1.05em;line-height:1.6;margin-bottom:4px}
.mcq-card pre{
  background:#0f172a;border:1px solid #334155;border-radius:8px;
  padding:14px;margin:12px 0;font-size:.9em;overflow-x:auto;
  color:#e2e8f0;line-height:1.5;
}
.option-list{list-style:none;padding:0}
.option-list li{
  background:#0f172a;border:1px solid #334155;border-radius:8px;
  padding:12px 16px;margin-bottom:8px;cursor:pointer;
  transition:all .15s;display:flex;align-items:flex-start;gap:10px;line-height:1.5;
}
.option-list li:hover{border-color:#3b82f6;background:#172033}
.option-list li.selected{border-color:#3b82f6;background:#1e3a5f}
.option-list li .letter{
  flex-shrink:0;width:26px;height:26px;border-radius:50%;
  background:#334155;display:flex;align-items:center;justify-content:center;
  font-size:.82em;font-weight:700;color:#94a3b8;margin-top:1px;
}
.option-list li.selected .letter{background:#3b82f6;color:#fff}

/* Results */
.score-box{
  background:linear-gradient(135deg,#1e3a5f,#3b1f6e);
  border-radius:16px;padding:32px;text-align:center;margin-bottom:28px;
}
.score-box .score-num{font-size:3em;font-weight:800}
.score-box .score-label{color:#94a3b8;margin-top:4px}
.confirm-banner{
  background:#064e3b;border:1px solid #34d399;border-radius:12px;
  padding:20px;text-align:center;margin-bottom:24px;
}
.confirm-banner .check{font-size:2em;margin-bottom:6px}
.confirm-banner p{color:#a7f3d0}
.result-card{
  background:#1e293b;border:1px solid #334155;border-radius:12px;
  padding:18px;margin-bottom:10px;
}
.result-card.correct{border-left:4px solid #34d399}
.result-card.incorrect{border-left:4px solid #f87171}
.result-card .rc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.result-card .rc-q{font-weight:600}
.result-card .rc-badge{padding:2px 10px;border-radius:12px;font-size:.78em;font-weight:600}
.result-card.correct .rc-badge{background:#064e3b;color:#34d399}
.result-card.incorrect .rc-badge{background:#7f1d1d;color:#f87171}
.result-card .rc-answer{color:#94a3b8;margin-top:4px;font-size:.92em;line-height:1.6}
.result-card .rc-explain{color:#cbd5e1;margin-top:8px;font-size:.88em;line-height:1.6;border-top:1px solid #334155;padding-top:8px}

/* Validation */
.validation-msg{
  background:#7f1d1d;border:1px solid #f87171;border-radius:8px;
  padding:12px 16px;margin-bottom:16px;color:#fca5a5;display:none;
}
.validation-msg.show{display:block;animation:fadeIn .3s ease}

@media(max-width:600px){
  .app{padding:14px 14px 80px}
  h1{font-size:1.5em}
  .mcq-card{padding:16px}
  .score-box .score-num{font-size:2.2em}
}
</style>
</head>
<body>
<div class="app">

<!-- Top bar -->
<div class="top-bar" id="topBar">
  <div class="progress-wrap"><div class="progress-fill" id="progressFill"></div></div>
  <div class="top-meta">
    <span id="progressText">Question 1 of 8</span>
    <span class="timer" id="timer">00:00</span>
  </div>
</div>

<!-- SCREEN: Welcome -->
<div class="screen active" id="scrWelcome">
  <h1>CS 205 — Quiz 3</h1>
  <p class="sub">Stacks &amp; Queues</p>

  <div class="info-box">
    <h3>Quiz Details</h3>
    <ul style="padding-left:20px;color:#cbd5e1">
      <li>8 multiple-choice questions</li>
      <li>~12 minutes</li>
      <li>One attempt only — choose your answers carefully</li>
    </ul>
  </div>

  <div class="info-box">
    <h3>Your Anonymous ID</h3>
    <p style="color:#94a3b8;margin-bottom:12px">Same ID as the pre-test — lets us track progress without using your name.</p>
    <label class="field">
      <span class="label-text">Last 4 digits of your phone number</span>
      <input type="text" id="idPhone" maxlength="4" pattern="[0-9]{4}" placeholder="e.g. 5103" inputmode="numeric">
    </label>
    <label class="field">
      <span class="label-text">Birth month (2 digits)</span>
      <input type="text" id="idMonth" maxlength="2" pattern="[0-9]{1,2}" placeholder="e.g. 03 for March" inputmode="numeric">
    </label>
  </div>

  <label class="field">
    <span class="label-text">Your Section</span>
    <select id="studentSection">
      <option value="">— Select —</option>
      <option value="treatment">Section A (Prof. Weihao's section)</option>
      <option value="control">Section B (Prof. Rolf's section)</option>
    </select>
  </label>

  <div class="validation-msg" id="welcomeError"></div>
  <div class="btn-row">
    <button class="btn btn-primary" onclick="startQuiz()">Start Quiz &rarr;</button>
  </div>
</div>

<!-- SCREEN: Quiz -->
<div class="screen" id="scrQuiz">
  <div id="quizContainer"></div>
  <div class="validation-msg" id="quizError"></div>
  <div class="btn-row">
    <button class="btn btn-secondary" onclick="prevQ()">&larr; Previous</button>
    <button class="btn btn-primary" id="nextBtn" onclick="nextQ()">Next &rarr;</button>
  </div>
</div>

<!-- SCREEN: Results -->
<div class="screen" id="scrResults">
  <div class="confirm-banner" id="confirmBanner">
    <div class="check">&#10003;</div>
    <p><strong>Quiz submitted!</strong> Your responses have been recorded.</p>
  </div>
  <div class="score-box">
    <div class="score-num" id="scoreNum">0/8</div>
    <div class="score-label">Quiz 3 Score</div>
  </div>
  <div class="section-header">
    <h2>Review</h2>
    <p>Correct answers and explanations.</p>
  </div>
  <div id="resultsContainer"></div>
  <div class="btn-row" style="margin-top:32px;justify-content:center">
    <a class="btn btn-secondary" href="index.html">&larr; Back to Home</a>
  </div>
</div>

</div>

<script>
const QUIZ_ID = "quiz3";
const QUIZ_TITLE = "Quiz 3: Stacks & Queues";

const QUESTIONS = [
  // ── STACKS (4 questions) ──────────────────────────────
  {
    id:1, topic:"Stacks",
    text:"Which data structure would you use to check if parentheses in an expression are balanced? e.g., ((a+b)*(c-d))",
    options:["Queue","Stack","Array","Linked List"],
    answer:1,
    explain:"Push each opening paren onto the stack. When you see a closing paren, pop and check for a match. If the stack is empty at the end with no mismatches, the expression is balanced. LIFO order naturally matches nested structures."
  },
  {
    id:2, topic:"Stacks",
    text:"You push A, B, C, D onto a stack, then pop twice, then push E, then pop once. What is on top?",
    options:["A","B","C","E"],
    answer:1,
    explain:"After push A,B,C,D: stack = [A,B,C,D] (D on top). Pop twice removes D, C: stack = [A,B]. Push E: stack = [A,B,E]. Pop once removes E: stack = [A,B]. Top = B."
  },
  {
    id:3, topic:"Stacks",
    text:"What is the time complexity of push and pop operations on a stack implemented with a linked list?",
    options:[
      "Push: O(1), Pop: O(n)",
      "Push: O(n), Pop: O(1)",
      "Push: O(1), Pop: O(1)",
      "Push: O(n), Pop: O(n)"
    ],
    answer:2,
    explain:"With a linked list, push adds a node at the head (O(1)) and pop removes the head node (O(1)). No shifting or resizing needed."
  },
  {
    id:4, topic:"Stacks",
    text:"Evaluate the postfix expression: 3 4 + 2 *",
    options:["9","10","14","24"],
    answer:2,
    explain:"Push 3, push 4. See +: pop 4 and 3, compute 3+4=7, push 7. Push 2. See *: pop 2 and 7, compute 7\u00D72=14, push 14. Result = 14."
  },
  // ── QUEUES (4 questions) ──────────────────────────────
  {
    id:5, topic:"Queues",
    text:"Which principle does a queue follow?",
    options:[
      "Last In, First Out (LIFO)",
      "First In, First Out (FIFO)",
      "Highest priority first",
      "Random access"
    ],
    answer:1,
    explain:"A queue processes elements in the order they arrive, like a line at a store. LIFO describes a stack. Highest priority first describes a priority queue."
  },
  {
    id:6, topic:"Queues",
    text:"You enqueue A, B, C, D into a queue, then dequeue twice. What is at the front of the queue?",
    options:["A","B","C","D"],
    answer:2,
    explain:"FIFO: enqueue A,B,C,D (front=A, rear=D). Dequeue removes A, then B. Front is now C."
  },
  {
    id:7, topic:"Queues",
    text:"A circular queue is implemented with an array of size 6. After several enqueue/dequeue operations, front = 4 and rear = 2. How many elements are in the queue?",
    options:["2","4","3","6"],
    answer:1,
    explain:"Elements at indices 4, 5, 0, 1 (wrapping around). Count = (2 \u2212 4 + 6) % 6 = 4. The formula (rear \u2212 front + capacity) % capacity handles the wrap-around."
  },
  {
    id:8, topic:"Queues",
    text:"Which real-world scenario is best modeled by a queue?",
    options:[
      "Undo/redo in a text editor",
      "Print jobs waiting to be processed",
      "Evaluating a mathematical expression",
      "Browser back button history"
    ],
    answer:1,
    explain:"Print jobs are processed in the order received (FIFO) \u2014 a perfect queue application. Undo/redo and browser history are stacks (LIFO). Expression evaluation uses a stack."
  }
];

// ── STATE ───────────────────────────────────────────────
let currentQ = 0;
let answers = new Array(QUESTIONS.length).fill(-1);
let timerInterval = null;
let elapsed = 0;
let anonId = "";
let studentSection = "";

const SHEETS_URL = "https://script.google.com/macros/s/AKfycbyRMqYXRah6RLPnxXKVoYU9grXOzFa6JkLpT6ce4i8Fkkr5H8nEKx6zeiYO5rRIZevh/exec";

// ── INIT ────────────────────────────────────────────────
document.addEventListener("DOMContentLoaded", buildQuiz);

function buildQuiz() {
  const c = document.getElementById("quizContainer");
  QUESTIONS.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "mcq-card";
    div.id = "mcq" + i;
    div.style.display = "none";
    let html = `<div class="q-num">Question ${i+1} of ${QUESTIONS.length} \u2014 ${q.topic}</div>`;
    html += `<div class="q-text">${q.text}</div>`;
    if (q.code) html += `<pre>${esc(q.code)}</pre>`;
    html += `<ul class="option-list">`;
    q.options.forEach((opt, oi) => {
      const letter = "ABCD"[oi];
      html += `<li onclick="pick(${i},${oi})" id="opt${i}_${oi}">
        <span class="letter">${letter}</span><span>${esc(opt)}</span></li>`;
    });
    html += `</ul>`;
    div.innerHTML = html;
    c.appendChild(div);
  });
}

// ── NAVIGATION ──────────────────────────────────────────
function goScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  window.scrollTo({top:0, behavior:"smooth"});
}

function updateBar() {
  const bar = document.getElementById("topBar");
  const fill = document.getElementById("progressFill");
  const txt = document.getElementById("progressText");
  bar.classList.add("visible");
  const pct = ((currentQ + 1) / QUESTIONS.length) * 100;
  fill.style.width = pct + "%";
  txt.textContent = `Question ${currentQ+1} of ${QUESTIONS.length}`;
}

// ── TIMER ───────────────────────────────────────────────
function startTimer() {
  const el = document.getElementById("timer");
  timerInterval = setInterval(() => {
    elapsed++;
    const m = String(Math.floor(elapsed/60)).padStart(2,"0");
    const s = String(elapsed%60).padStart(2,"0");
    el.textContent = m + ":" + s;
  }, 1000);
}

// ── START ───────────────────────────────────────────────
function startQuiz() {
  const phone = document.getElementById("idPhone").value.trim();
  const month = document.getElementById("idMonth").value.trim();
  studentSection = document.getElementById("studentSection").value;
  const err = document.getElementById("welcomeError");
  if (phone.length !== 4 || !/^\d{4}$/.test(phone)) { showErr(err, "Please enter exactly 4 digits for your phone number."); return; }
  if (!month || !/^\d{1,2}$/.test(month) || +month < 1 || +month > 12) { showErr(err, "Please enter a valid birth month (01\u201312)."); return; }
  if (!studentSection) { showErr(err, "Please select your section."); return; }
  anonId = phone + month.padStart(2, "0");
  hideErr(err);
  startTimer();
  goScreen("scrQuiz");
  showQ(0);
}

// ── QUIZ INTERACTION ────────────────────────────────────
function showQ(n) {
  currentQ = n;
  document.querySelectorAll(".mcq-card").forEach(c => c.style.display = "none");
  document.getElementById("mcq" + n).style.display = "block";
  document.getElementById("nextBtn").textContent = n === QUESTIONS.length - 1 ? "Submit Quiz \u2192" : "Next \u2192";
  updateBar();
}

function pick(qi, oi) {
  answers[qi] = oi;
  const card = document.getElementById("mcq" + qi);
  card.querySelectorAll(".option-list li").forEach((li, idx) => {
    li.classList.toggle("selected", idx === oi);
  });
  hideErr(document.getElementById("quizError"));
}

function nextQ() {
  const err = document.getElementById("quizError");
  if (answers[currentQ] === -1) { showErr(err, "Please select an answer."); return; }
  hideErr(err);
  if (currentQ < QUESTIONS.length - 1) showQ(currentQ + 1);
  else submitQuiz();
}

function prevQ() {
  if (currentQ > 0) showQ(currentQ - 1);
}

// ── SUBMIT ──────────────────────────────────────────────
function submitQuiz() {
  clearInterval(timerInterval);
  let score = 0;
  QUESTIONS.forEach((q, i) => { if (answers[i] === q.answer) score++; });

  const payload = {
    quiz: QUIZ_ID,
    timestamp: new Date().toISOString(),
    anonId: anonId,
    section: studentSection,
    duration: elapsed,
    score: score,
    total: QUESTIONS.length,
  };
  QUESTIONS.forEach((q, i) => {
    payload["Q" + (i+1)] = "ABCD"[answers[i]];
  });

  if (SHEETS_URL !== "YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL") {
    var iframe = document.createElement("iframe");
    iframe.name = "sheets-submit";
    iframe.style.display = "none";
    document.body.appendChild(iframe);
    var form = document.createElement("form");
    form.method = "POST";
    form.action = SHEETS_URL;
    form.target = "sheets-submit";
    var input = document.createElement("input");
    input.type = "hidden";
    input.name = "data";
    input.value = JSON.stringify(payload);
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
    form.remove();
    setTimeout(function(){ iframe.remove(); }, 15000);
  } else {
    console.log("Sheets URL not configured. Payload:", payload);
  }

  showResults(score);
}

// ── RESULTS ─────────────────────────────────────────────
function showResults(score) {
  document.getElementById("scoreNum").textContent = score + "/" + QUESTIONS.length;
  const c = document.getElementById("resultsContainer");
  c.innerHTML = "";
  QUESTIONS.forEach((q, i) => {
    const correct = answers[i] === q.answer;
    const div = document.createElement("div");
    div.className = "result-card " + (correct ? "correct" : "incorrect");
    const yours = answers[i] >= 0 ? "ABCD"[answers[i]] : "?";
    const right = "ABCD"[q.answer];
    div.innerHTML = `
      <div class="rc-header">
        <span class="rc-q">Q${i+1}: ${q.topic}</span>
        <span class="rc-badge">${correct ? "\u2713 Correct" : "\u2717 Incorrect"}</span>
      </div>
      <div class="rc-answer">
        Your answer: <strong>${yours}</strong>${correct ? "" : " \u2014 Correct: <strong>" + right + ". " + esc(q.options[q.answer]) + "</strong>"}
      </div>
      <div class="rc-explain">${q.explain}</div>`;
    c.appendChild(div);
  });
  document.getElementById("topBar").classList.remove("visible");
  goScreen("scrResults");
}

// ── HELPERS ─────────────────────────────────────────────
function esc(s) { const d = document.createElement("div"); d.textContent = s; return d.innerHTML; }
function showErr(el, msg) { el.textContent = msg; el.classList.add("show"); }
function hideErr(el) { el.classList.remove("show"); }
</script>
</body>
</html>
