<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CS 205 — Quiz 2: Linked Lists &amp; Recursion</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
  background:#0f172a;color:#e2e8f0;min-height:100vh;padding:0;
}
button{font-family:inherit}
.app{max-width:720px;margin:0 auto;padding:20px 20px 80px}

/* Top bar */
.top-bar{
  position:sticky;top:0;z-index:100;
  background:#0f172aee;backdrop-filter:blur(8px);
  padding:12px 0 8px;margin-bottom:24px;display:none;
}
.top-bar.visible{display:block}
.progress-wrap{background:#1e293b;border-radius:8px;height:8px;overflow:hidden;margin-bottom:8px}
.progress-fill{height:100%;background:linear-gradient(90deg,#3b82f6,#8b5cf6);border-radius:8px;transition:width .4s ease;width:0}
.top-meta{display:flex;justify-content:space-between;font-size:.82em;color:#94a3b8}
.top-meta .timer{color:#60a5fa}

/* Screens */
.screen{display:none;animation:fadeIn .3s ease}
.screen.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* Welcome */
h1{font-size:1.9em;margin-bottom:6px}
.sub{color:#94a3b8;margin-bottom:28px;line-height:1.6}
.info-box{
  background:#1e293b;border:1px solid #334155;border-radius:12px;
  padding:20px;margin-bottom:20px;line-height:1.7;
}
.info-box h3{color:#60a5fa;margin-bottom:8px}

/* Form elements */
label.field{display:block;margin-bottom:18px}
label.field .label-text{display:block;font-weight:600;margin-bottom:6px;color:#f1f5f9}
input[type=text],select{
  width:100%;padding:12px 14px;border-radius:8px;border:1px solid #334155;
  background:#1e293b;color:#e2e8f0;font-size:1em;transition:border-color .2s;
}
input[type=text]:focus,select:focus{outline:none;border-color:#3b82f6}

/* Buttons */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:12px 28px;border-radius:8px;border:none;
  font-size:1em;font-weight:600;cursor:pointer;transition:all .2s;
}
.btn-primary{background:#3b82f6;color:#fff}
.btn-primary:hover{background:#2563eb;transform:translateY(-1px)}
.btn-primary:disabled{background:#334155;color:#64748b;cursor:not-allowed;transform:none}
.btn-secondary{background:#1e293b;color:#94a3b8;border:1px solid #334155}
.btn-secondary:hover{border-color:#3b82f6;color:#e2e8f0}
.btn-row{display:flex;gap:12px;margin-top:24px;flex-wrap:wrap}

/* Section header */
.section-header{margin-bottom:24px}
.section-header h2{font-size:1.5em;margin-bottom:4px}
.section-header p{color:#94a3b8;line-height:1.6}
.section-tag{
  display:inline-block;padding:3px 10px;border-radius:12px;
  font-size:.75em;font-weight:600;margin-bottom:10px;
}
.tag-purple{background:#3b1f6e;color:#a78bfa}
.tag-green{background:#064e3b;color:#34d399}

/* MCQ card */
.mcq-card{
  background:#1e293b;border:1px solid #334155;border-radius:12px;
  padding:24px;margin-bottom:16px;
}
.mcq-card .q-num{color:#64748b;font-size:.85em;margin-bottom:8px}
.mcq-card .q-text{font-size:1.05em;line-height:1.6;margin-bottom:4px}
.mcq-card pre{
  background:#0f172a;border:1px solid #334155;border-radius:8px;
  padding:14px;margin:12px 0;font-size:.9em;overflow-x:auto;
  color:#e2e8f0;line-height:1.5;
}
.option-list{list-style:none;padding:0}
.option-list li{
  background:#0f172a;border:1px solid #334155;border-radius:8px;
  padding:12px 16px;margin-bottom:8px;cursor:pointer;
  transition:all .15s;display:flex;align-items:flex-start;gap:10px;line-height:1.5;
}
.option-list li:hover{border-color:#3b82f6;background:#172033}
.option-list li.selected{border-color:#3b82f6;background:#1e3a5f}
.option-list li .letter{
  flex-shrink:0;width:26px;height:26px;border-radius:50%;
  background:#334155;display:flex;align-items:center;justify-content:center;
  font-size:.82em;font-weight:700;color:#94a3b8;margin-top:1px;
}
.option-list li.selected .letter{background:#3b82f6;color:#fff}

/* Results */
.score-box{
  background:linear-gradient(135deg,#1e3a5f,#3b1f6e);
  border-radius:16px;padding:32px;text-align:center;margin-bottom:28px;
}
.score-box .score-num{font-size:3em;font-weight:800}
.score-box .score-label{color:#94a3b8;margin-top:4px}
.confirm-banner{
  background:#064e3b;border:1px solid #34d399;border-radius:12px;
  padding:20px;text-align:center;margin-bottom:24px;
}
.confirm-banner .check{font-size:2em;margin-bottom:6px}
.confirm-banner p{color:#a7f3d0}
.result-card{
  background:#1e293b;border:1px solid #334155;border-radius:12px;
  padding:18px;margin-bottom:10px;
}
.result-card.correct{border-left:4px solid #34d399}
.result-card.incorrect{border-left:4px solid #f87171}
.result-card .rc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.result-card .rc-q{font-weight:600}
.result-card .rc-badge{padding:2px 10px;border-radius:12px;font-size:.78em;font-weight:600}
.result-card.correct .rc-badge{background:#064e3b;color:#34d399}
.result-card.incorrect .rc-badge{background:#7f1d1d;color:#f87171}
.result-card .rc-answer{color:#94a3b8;margin-top:4px;font-size:.92em;line-height:1.6}
.result-card .rc-explain{color:#cbd5e1;margin-top:8px;font-size:.88em;line-height:1.6;border-top:1px solid #334155;padding-top:8px}

/* Validation */
.validation-msg{
  background:#7f1d1d;border:1px solid #f87171;border-radius:8px;
  padding:12px 16px;margin-bottom:16px;color:#fca5a5;display:none;
}
.validation-msg.show{display:block;animation:fadeIn .3s ease}

@media(max-width:600px){
  .app{padding:14px 14px 80px}
  h1{font-size:1.5em}
  .mcq-card{padding:16px}
  .score-box .score-num{font-size:2.2em}
}
</style>
</head>
<body>
<div class="app">

<!-- Top bar -->
<div class="top-bar" id="topBar">
  <div class="progress-wrap"><div class="progress-fill" id="progressFill"></div></div>
  <div class="top-meta">
    <span id="progressText">Question 1 of 8</span>
    <span class="timer" id="timer">00:00</span>
  </div>
</div>

<!-- SCREEN: Welcome -->
<div class="screen active" id="scrWelcome">
  <h1>CS 205 — Quiz 2</h1>
  <p class="sub">Linked Lists &amp; Recursion</p>

  <div class="info-box">
    <h3>Quiz Details</h3>
    <ul style="padding-left:20px;color:#cbd5e1">
      <li>8 multiple-choice questions</li>
      <li>~12 minutes</li>
      <li>This quiz is <strong>graded</strong></li>
      <li>One attempt only — choose your answers carefully</li>
    </ul>
  </div>

  <label class="field">
    <span class="label-text">Your Name</span>
    <input type="text" id="studentName" placeholder="First and Last name">
  </label>
  <label class="field">
    <span class="label-text">Your Section</span>
    <select id="studentSection">
      <option value="">— Select —</option>
      <option value="treatment">Section A (Prof. Weihao's section)</option>
      <option value="control">Section B (Prof. Rolf's section)</option>
    </select>
  </label>

  <div class="validation-msg" id="welcomeError"></div>
  <div class="btn-row">
    <button class="btn btn-primary" onclick="startQuiz()">Start Quiz &rarr;</button>
  </div>
</div>

<!-- SCREEN: Quiz -->
<div class="screen" id="scrQuiz">
  <div id="quizContainer"></div>
  <div class="validation-msg" id="quizError"></div>
  <div class="btn-row">
    <button class="btn btn-secondary" onclick="prevQ()">&larr; Previous</button>
    <button class="btn btn-primary" id="nextBtn" onclick="nextQ()">Next &rarr;</button>
  </div>
</div>

<!-- SCREEN: Results -->
<div class="screen" id="scrResults">
  <div class="confirm-banner" id="confirmBanner">
    <div class="check">&#10003;</div>
    <p><strong>Quiz submitted!</strong> Your responses have been recorded.</p>
  </div>
  <div class="score-box">
    <div class="score-num" id="scoreNum">0/8</div>
    <div class="score-label">Quiz 2 Score</div>
  </div>
  <div class="section-header">
    <h2>Review</h2>
    <p>Correct answers and explanations.</p>
  </div>
  <div id="resultsContainer"></div>
  <div class="btn-row" style="margin-top:32px;justify-content:center">
    <a class="btn btn-secondary" href="index.html">&larr; Back to Home</a>
  </div>
</div>

</div>

<script>
const QUIZ_ID = "quiz2";
const QUIZ_TITLE = "Quiz 2: Linked Lists & Recursion";

const QUESTIONS = [
  // ── LINKED LISTS (4 questions) ─────────────────────────
  {
    id:1, topic:"Linked Lists",
    text:"What is the time complexity of accessing the k-th element in a singly linked list of n nodes?",
    options:["O(1)","O(k)","O(n)","O(n\u00B2)"],
    answer:1,
    explain:"You must traverse from the head, following k next pointers. Unlike arrays, there's no direct index access. O(k) is O(n) in the worst case when k = n."
  },
  {
    id:2, topic:"Linked Lists",
    text:"You have a singly linked list: A \u2192 B \u2192 C \u2192 D. You want to delete node C. What must you update?",
    options:[
      "Set C.next = null",
      "Set B.next = D",
      "Set D.next = B",
      "Set A.next = D"
    ],
    answer:1,
    explain:"To remove C, bypass it by pointing its predecessor (B) to its successor (D). This is why deletion in a singly linked list requires access to the previous node."
  },
  {
    id:3, topic:"Linked Lists",
    text:"Which advantage does a linked list have over an array?",
    options:[
      "Faster access to elements by index",
      "Less memory usage per element",
      "O(1) insertion at the front without shifting",
      "Better cache performance"
    ],
    answer:2,
    explain:"Inserting at the front of a linked list is O(1) \u2014 just create a new node and point it to the old head. Arrays require shifting all elements. Arrays win on index access, memory density, and cache performance."
  },
  {
    id:4, topic:"Linked Lists",
    text:"A doubly linked list with head and tail pointers can perform which operation in O(1) that a singly linked list cannot?",
    options:[
      "Insert at front",
      "Get the first element",
      "Remove the last element",
      "Check if the list is empty"
    ],
    answer:2,
    explain:"Removing the last element requires updating the second-to-last node\u2019s next pointer. In a doubly linked list, tail.prev gives you that node in O(1). A singly linked list must traverse the entire list to find it."
  },
  // ── RECURSION (4 questions) ────────────────────────────
  {
    id:5, topic:"Recursion",
    text:"What does this method return when called with f(4)?",
    code:"int f(int n) {\n    if (n == 0) return 0;\n    return n + f(n - 1);\n}",
    options:["4","6","10","24"],
    answer:2,
    explain:"f(4) = 4 + f(3) = 4 + 3 + f(2) = 4 + 3 + 2 + f(1) = 4 + 3 + 2 + 1 + f(0) = 4+3+2+1+0 = 10. This computes the sum 1+2+\u2026+n."
  },
  {
    id:6, topic:"Recursion",
    text:"How many times is the base case reached when calling fib(5) with this naive implementation?",
    code:"int fib(int n) {\n    if (n <= 1) return n;\n    return fib(n-1) + fib(n-2);\n}",
    options:["2","3","5","8"],
    answer:2,
    explain:"Drawing the recursion tree: fib(5) branches into fib(4)+fib(3), which further branches. The base cases (n=0 or n=1) are reached 5 times total: fib(1) is called 3 times, fib(0) is called 2 times."
  },
  {
    id:7, topic:"Recursion",
    text:"What is the time complexity of the naive recursive Fibonacci implementation shown above?",
    options:["O(n)","O(n\u00B2)","O(2\u207F)","O(n log n)"],
    answer:2,
    explain:"Each call branches into two recursive calls, creating a binary tree of calls. The tree has roughly 2\u207F nodes. This is why memoization or dynamic programming is essential for Fibonacci."
  },
  {
    id:8, topic:"Recursion",
    text:"A recursive method works correctly but is very slow for large inputs. Which technique can improve its performance by storing previously computed results?",
    options:["Encapsulation","Memoization","Polymorphism","Garbage collection"],
    answer:1,
    explain:"Memoization stores the results of expensive function calls and returns the cached result when the same inputs occur again. It converts the exponential Fibonacci into O(n) by avoiding redundant computation."
  }
];

// ── STATE ───────────────────────────────────────────────
let currentQ = 0;
let answers = new Array(QUESTIONS.length).fill(-1);
let timerInterval = null;
let elapsed = 0;
let studentName = "";
let studentSection = "";

const SHEETS_URL = "https://script.google.com/macros/s/AKfycbyRMqYXRah6RLPnxXKVoYU9grXOzFa6JkLpT6ce4i8Fkkr5H8nEKx6zeiYO5rRIZevh/exec";

// ── INIT ────────────────────────────────────────────────
document.addEventListener("DOMContentLoaded", buildQuiz);

function buildQuiz() {
  const c = document.getElementById("quizContainer");
  QUESTIONS.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "mcq-card";
    div.id = "mcq" + i;
    div.style.display = "none";
    let html = `<div class="q-num">Question ${i+1} of ${QUESTIONS.length} \u2014 ${q.topic}</div>`;
    html += `<div class="q-text">${q.text}</div>`;
    if (q.code) html += `<pre>${esc(q.code)}</pre>`;
    html += `<ul class="option-list">`;
    q.options.forEach((opt, oi) => {
      const letter = "ABCD"[oi];
      html += `<li onclick="pick(${i},${oi})" id="opt${i}_${oi}">
        <span class="letter">${letter}</span><span>${esc(opt)}</span></li>`;
    });
    html += `</ul>`;
    div.innerHTML = html;
    c.appendChild(div);
  });
}

// ── NAVIGATION ──────────────────────────────────────────
function goScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  window.scrollTo({top:0, behavior:"smooth"});
}

function updateBar() {
  const bar = document.getElementById("topBar");
  const fill = document.getElementById("progressFill");
  const txt = document.getElementById("progressText");
  bar.classList.add("visible");
  const pct = ((currentQ + 1) / QUESTIONS.length) * 100;
  fill.style.width = pct + "%";
  txt.textContent = `Question ${currentQ+1} of ${QUESTIONS.length}`;
}

// ── TIMER ───────────────────────────────────────────────
function startTimer() {
  const el = document.getElementById("timer");
  timerInterval = setInterval(() => {
    elapsed++;
    const m = String(Math.floor(elapsed/60)).padStart(2,"0");
    const s = String(elapsed%60).padStart(2,"0");
    el.textContent = m + ":" + s;
  }, 1000);
}

// ── START ───────────────────────────────────────────────
function startQuiz() {
  studentName = document.getElementById("studentName").value.trim();
  studentSection = document.getElementById("studentSection").value;
  const err = document.getElementById("welcomeError");
  if (!studentName) { showErr(err, "Please enter your name."); return; }
  if (!studentSection) { showErr(err, "Please select your section."); return; }
  hideErr(err);
  startTimer();
  goScreen("scrQuiz");
  showQ(0);
}

// ── QUIZ INTERACTION ────────────────────────────────────
function showQ(n) {
  currentQ = n;
  document.querySelectorAll(".mcq-card").forEach(c => c.style.display = "none");
  document.getElementById("mcq" + n).style.display = "block";
  document.getElementById("nextBtn").textContent = n === QUESTIONS.length - 1 ? "Submit Quiz \u2192" : "Next \u2192";
  updateBar();
}

function pick(qi, oi) {
  answers[qi] = oi;
  const card = document.getElementById("mcq" + qi);
  card.querySelectorAll(".option-list li").forEach((li, idx) => {
    li.classList.toggle("selected", idx === oi);
  });
  hideErr(document.getElementById("quizError"));
}

function nextQ() {
  const err = document.getElementById("quizError");
  if (answers[currentQ] === -1) { showErr(err, "Please select an answer."); return; }
  hideErr(err);
  if (currentQ < QUESTIONS.length - 1) showQ(currentQ + 1);
  else submitQuiz();
}

function prevQ() {
  if (currentQ > 0) showQ(currentQ - 1);
}

// ── SUBMIT ──────────────────────────────────────────────
function submitQuiz() {
  clearInterval(timerInterval);
  let score = 0;
  QUESTIONS.forEach((q, i) => { if (answers[i] === q.answer) score++; });

  const payload = {
    quiz: QUIZ_ID,
    timestamp: new Date().toISOString(),
    name: studentName,
    section: studentSection,
    duration: elapsed,
    score: score,
    total: QUESTIONS.length,
  };
  QUESTIONS.forEach((q, i) => {
    payload["Q" + (i+1)] = "ABCD"[answers[i]];
  });

  if (SHEETS_URL !== "YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL") {
    var iframe = document.createElement("iframe");
    iframe.name = "sheets-submit";
    iframe.style.display = "none";
    document.body.appendChild(iframe);
    var form = document.createElement("form");
    form.method = "POST";
    form.action = SHEETS_URL;
    form.target = "sheets-submit";
    var input = document.createElement("input");
    input.type = "hidden";
    input.name = "data";
    input.value = JSON.stringify(payload);
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
    form.remove();
    setTimeout(function(){ iframe.remove(); }, 15000);
  } else {
    console.log("Sheets URL not configured. Payload:", payload);
  }

  showResults(score);
}

// ── RESULTS ─────────────────────────────────────────────
function showResults(score) {
  document.getElementById("scoreNum").textContent = score + "/" + QUESTIONS.length;
  const c = document.getElementById("resultsContainer");
  c.innerHTML = "";
  QUESTIONS.forEach((q, i) => {
    const correct = answers[i] === q.answer;
    const div = document.createElement("div");
    div.className = "result-card " + (correct ? "correct" : "incorrect");
    const yours = answers[i] >= 0 ? "ABCD"[answers[i]] : "?";
    const right = "ABCD"[q.answer];
    div.innerHTML = `
      <div class="rc-header">
        <span class="rc-q">Q${i+1}: ${q.topic}</span>
        <span class="rc-badge">${correct ? "\u2713 Correct" : "\u2717 Incorrect"}</span>
      </div>
      <div class="rc-answer">
        Your answer: <strong>${yours}</strong>${correct ? "" : " \u2014 Correct: <strong>" + right + ". " + esc(q.options[q.answer]) + "</strong>"}
      </div>
      <div class="rc-explain">${q.explain}</div>`;
    c.appendChild(div);
  });
  document.getElementById("topBar").classList.remove("visible");
  goScreen("scrResults");
}

// ── HELPERS ─────────────────────────────────────────────
function esc(s) { const d = document.createElement("div"); d.textContent = s; return d.innerHTML; }
function showErr(el, msg) { el.textContent = msg; el.classList.add("show"); }
function hideErr(el) { el.classList.remove("show"); }
</script>
</body>
</html>
